<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>My Piece in Verovio</title>
    <style>
        #app {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
        #controls {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        button {
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="box">
    <div class="header"><h1>Week 3</h1>
        <p>[Readability:]</p>
        <p>[In MusicXML, each element that contributes to the creation of a note has a separate line, therefore between each 'note' element is all the data defining that note. MEI files include all data relating to a note on the one line in the one element. MusicXML therefore has a larger file size compared to an MEI file.]</p>
        <p>[Editability:]</p>
        <p>[Furthermore, in each line of MEI code that is describing a note, an id is given to the note, giving an easier and more editable file. Without surfing through thousands of lines of code, through the MEIfriend webpage, it allows you to highlight any part of the score and view its subsequent line of code.]</p>
        <p>[Interchangability:]</p>
        <p>[Both MusicXML and MEI have great interoperability. MusicXML file formats can be opened in text-writing software along with any music notation software too.]</p>
    <div id="app">Verovio is loading...</div>
    <div id="controls">
        <button id="playBtn">Play</button>
        <button id="pauseBtn">Pause</button>
        <button id="stopBtn">Stop</button>
    </div>
<script src="https://www.verovio.org/javascript/latest/verovio-toolkit.js"></script>
    <script>
        // Initialize Verovio toolkit
        const verovioToolkit = new verovio.toolkit();

        const options = {
            pageWidth: 2000,
            pageHeight: 2500,
            scale: 40,
            adjustPageHeight: true
        };

        // Initialize playback controls
        let audioContext = null;
        let audioBufferSource = null;
        let isPlaying = false;

        // Fetch and render MEI file
        fetch('data/MacArthurPark.mei')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load MEI file');
                return response.text();
            })
            .then(meiData => {
                verovioToolkit.setOptions(options);
                verovioToolkit.loadData(meiData);
                const svg = verovioToolkit.renderToSVG(1);
                document.getElementById('app').innerHTML = svg;
            })
            .catch(error => console.error('Error loading MEI file:', error));

        // Playback Functions
        function playAudio() {
            if (isPlaying) return;
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();

            const midiData = verovioToolkit.renderToMIDI();
            audioContext.decodeAudioData(midiData.buffer, buffer => {
                audioBufferSource = audioContext.createBufferSource();
                audioBufferSource.buffer = buffer;
                audioBufferSource.connect(audioContext.destination);
                audioBufferSource.start(0);
                isPlaying = true;

                // Stop playing when the buffer ends
                audioBufferSource.onended = () => { isPlaying = false; };
            });
        }

        function pauseAudio() {
            if (audioContext && isPlaying) {
                audioContext.suspend();
                isPlaying = false;
            }
        }

        function stopAudio() {
            if (audioContext) {
                audioContext.close();
                audioContext = null;
                isPlaying = false;
            }
        }

        // Button Event Listeners
        document.getElementById('playBtn').addEventListener('click', playAudio);
        document.getElementById('pauseBtn').addEventListener('click', pauseAudio);
        document.getElementById('stopBtn').addEventListener('click', stopAudio);
    </script>
    </div>
</body>
</html>
