<html>
<head>
  <title>My Piece</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/myMeta.css" media="all" />
  <link rel="stylesheet" href="css/style.css" media="all" />
  <script src="js/CETEI.js"></script>
  <style>
    #app {
      max-width: 90%;
      height: 600px;
      overflow-x: auto;
      border: 1px solid lightgray;
      padding: 10px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div id="MEImeta">Loading metadata...</div>
  <div id="app">Verovio is loading the score...</div>
  <div><p>[Discuss how you would format your metadata here]</p></div>
  <script type="module">
      // Import Verovio App module
    import 'https://www.verovio.org/javascript/app/verovio-app.js';

    // Initialize Verovio with basic settings
    const app = new Verovio.App(document.getElementById("app"), {
      defaultView: "responsive",
      defaultZoom: 3,
      scale: 75,
      enableResponsive: true,
    });

    // Fetch and load MEI data for score display
    fetch("data/MacArthurPark_2.mei")
      .then(response => {
        if (!response.ok) throw new Error("MEI file not found");
        return response.text();
      })
      .then(text => app.loadData(text, { format: 'mei' }))
      .catch(error => {
        console.error("Error loading MEI file:", error);
        document.getElementById("app").innerText = "Failed to load score.";
      });
    </script>
  <script>
    // Get, parse, and show TEI data
    var CETEIcean = new CETEI()
    CETEIcean.getHTML5("data/MacArthurPark_2.mei", function(data) {
      document.getElementById("TEI").appendChild(data)
    })
     // Use CETEIcean to fetch and display metadata
    const CETEI4MEI = new CETEI();
    CETEI4MEI.addBehaviors({
      namespaces: { mei: "http://www.music-encoding.org/ns/mei" }
    });

    CETEI4MEI.getHTML5("data/MacArthurPark_2.mei", data => {
      // Extract metadata from <meiHead>
      const meiHead = data.querySelector('mei-meiHead');
      if (meiHead) {
        document.getElementById("MEImeta").innerHTML = "";
        document.getElementById("MEImeta").appendChild(meiHead);
      } else {
        document.getElementById("MEImeta").innerText = "No metadata found in MEI file.";
      }
    });
  </script>

  <script>
      var xhr = new XMLHttpRequest()
      xhr.open('GET', 'data/MacArthurPark_2.mei') //  change this to the right file
      xhr.send(null)
      /* Deal with the response */
      xhr.onreadystatechange = function () {
        var DONE = 4
        var OK = 200
        if (xhr.readyState === DONE) {
          if (xhr.status === OK) {
            var parser = new DOMParser()
            var meiDoc = parser.parseFromString(xhr.responseText,"text/xml")
            document.querySelector("#meta").innerHTML += "<h1>" + meiDoc.querySelector("[*|id='title12345']").textContent + "</h1>" 
            document.querySelector("#meta").innerHTML += "<p><strong>Composer:</strong> <a href=\"" + meiDoc.querySelector("[*|id='pers12345']").getAttribute('authURI') + "\">" + meiDoc.querySelector("[*|id='pers12345']").textContent + "</a></p>"
            
          }
        }
      }
    </script>
  
</body>
<footer><p>Score rendering provided by <a href="http://www.verovio.org">Verovio</a>. Metadata rendered by <a href="https://github.com/TEIC/CETEIcean/"> CETEIcean</a>.</p></footer>
</html>
