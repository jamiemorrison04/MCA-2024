<html>
<head>
  <title>My Piece</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/myMeta.css" media="all" />
  <link rel="stylesheet" href="css/style.css" media="all" />
  <script src="js/CETEI.js"></script>
  <style>
    #app {
      max-width: 90%;
      height: 600px;
      overflow-x: auto;
      border: 1px solid lightgray;
      padding: 10px;
      box-sizing: border-box;
    }
     #MEImeta {
    padding: 20px;
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-family: Arial, sans-serif;
  }

  #MEImeta h1 {
    font-size: 24px;
    margin-bottom: 10px;
  }

  #MEImeta p {
    margin: 5px 0;
  }

  #MEImeta a {
    color: #007bff;
    text-decoration: none;
  }

  #MEImeta a:hover {
    text-decoration: underline;
  </style>
</head>
<body>
  <div id="MEImeta">Loading metadata...</div>
  <div id="app">Verovio is loading the score...</div>
  <div><p>[Discuss how you would format your metadata here]</p></div>
  <script type="module">
      // Import Verovio App module
    import 'https://www.verovio.org/javascript/app/verovio-app.js';

    // Initialize Verovio with basic settings
    const app = new Verovio.App(document.getElementById("app"), {
      defaultView: "responsive",
      defaultZoom: 3,
      scale: 75,
      enableResponsive: true,
    });

    // Fetch and load MEI data for score display
    fetch("data/MacArthurPark_2.mei")
      .then(response => {
        if (!response.ok) throw new Error("MEI file not found");
        return response.text();
      })
      .then(text => app.loadData(text, { format: 'mei' }))
      .catch(error => {
        console.error("Error loading MEI file:", error);
        document.getElementById("app").innerText = "Failed to load score.";
      });
    </script>
  
<script>
    // Use CETEIcean to fetch and display metadata
    const CETEI4MEI = new CETEI();
    CETEI4MEI.addBehaviors({
      namespaces: { mei: "http://www.music-encoding.org/ns/mei" }
    });

    CETEI4MEI.getHTML5("data/MacArthurPark_2.mei", data => {
      const metadataContainer = document.getElementById("MEImeta");
      metadataContainer.innerHTML = ""; // Clear loading text

      const meiHead = data.querySelector('mei-meiHead');
      if (meiHead) {
        // Extract and format metadata
        const title = meiHead.querySelector("titleStmt title")?.textContent || "MacArthur Park";
        const composer = meiHead.querySelector("persName")?.textContent || "Maynard Ferguson";
        const composerURI = meiHead.querySelector("persName")?.getAttribute("authURI") || "http://viaf.org/viaf/59269449";
        const writer = meiHead.querySelector("persName")?.textContent || "Jimmy Webb";
        const writerURI = meiHead.querySelector("persName")?.getAttribute("authURI") || "http://viaf.org/viaf/33636158";
        const arranger = meiHead.querySelector("persName")?.textContent || "Adrian Drover";
        const arrangerURI = meiHead.querySelector("persName")?.getAttribute("authURI") || "http://viaf.org/viaf/304969586";
        const encoder = meiHead.querySelector("persName")?.textContent || "Jamie Morrison";
        const publisher = meiHead.querySelector("persName")?.textContent || "Sony MBG Music Entertainment";
        const publisherURI = meiHead.querySelector("persName")?.getAttribute("authURI") || "http://viaf.org/viaf/148113165";

        const workTitle = document.createElement("h1");
        workTitle.textContent = title;

        const composerInfo = document.createElement("p");
        composerInfo.innerHTML = `<strong>Composer:</strong> <a href="${composerURI}">${composer}</a>`;

        const writerInfo = document.createElement("p");
        writerInfo.innerHTML = `<strong>Writer:</strong> <a href="${writerURI}">${writer}</a>`;

        const arrangerInfo = document.createElement("p");
        arrangerInfo.innerHTML = `<strong>Arranger:</strong> <a href="${arrangerURI}">${arranger}</a>`;

        const publisherInfo = document.createElement("p");
        publisherInfo.innerHTML = `<strong>Publisher:</strong> <a href="${publisherURI}">${publisher}</a>`;
        
        const encoderInfo = document.createElement("p");
        encoderInfo.innerHTML = `<strong>Encoded by</strong> ${encoder}`;


        metadataContainer.appendChild(workTitle);
        metadataContainer.appendChild(composerInfo);
        metadataContainer.appendChild(writerInfo);
        metadataContainer.appendChild(arrangerInfo);
        metadataContainer.appendChild(publisherInfo);
        metadataContainer.appendChild(encoderInfo);
        
      } else {
        metadataContainer.innerText = "No metadata found in MEI file.";
      }
    });
  </script>
  
</body>
<footer><p>Score rendering provided by <a href="http://www.verovio.org">Verovio</a>. Metadata rendered by <a href="https://github.com/TEIC/CETEIcean/"> CETEIcean</a>.</p></footer>
</html>
